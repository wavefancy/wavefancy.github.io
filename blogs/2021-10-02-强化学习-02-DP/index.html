<!DOCTYPE html>
<html lang="en-US" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ===============================================-->
  <!--    Document Title-->
  <!-- ===============================================-->
    <title>强化学习-动态规划-DP - Wang Lab</title>

  <!-- ===============================================-->
  <!--    Favicons-->
  <!-- ===============================================-->
  
  
   
	  <link rel="apple-touch-icon" sizes="180x180" href="../../pages/assets/img/favicons/apple-touch-icon.png">
	  <link rel="icon" type="image/png" sizes="32x32" href="../../pages/assets/img/favicons/favicon-32x32.png">
	  <link rel="icon" type="image/png" sizes="16x16" href="../../pages/assets/img/favicons/favicon-16x16.png ">
	  <link rel="shortcut icon" type="image/x-icon" href="../../pages/assets/img/favicons/favicon.ico">
	  <link rel="manifest" href="../../pages/assets/img/favicons/manifest.json">
	  <meta name="msapplication-TileImage" content="../../pages/assets/img/favicons/mstile-150x150.png">
	  <meta name="theme-color" content="#ffffff">

	  <!-- ===============================================-->
	  <!--    Stylesheets-->
	  <!-- ===============================================-->
	  <link href="../../pages/assets/lib/loaders.css/loaders.min.css" rel="stylesheet">
	  <!-- <link href="https://fonts.googleapis.com/css?family=PT+Mono%7cPT+Serif:400,400i%7cLato:100,300,400,700,800,900"
		rel="stylesheet"> -->
    <link href="../../css/fonts/font-face.css"
		rel="stylesheet">
	  <link href="../../pages/assets/lib/fancybox/jquery.fancybox.min.css" rel="stylesheet">
	  <link href="../../pages/assets/css/theme.css" rel="stylesheet">
  
  
  <style>
    .btn-outline-primary{
      cursor: pointer;
      color: #000;
      border-color: #000;
    }
    .btn-outline-primary:disabled{
      color: #000;
      border-color: #000;
      opacity: .3;
    }
    .btn-outline-primary:not(:disabled):hover{
      background-color: #000;
      border-color: #000;
    }
  </style>
<!--This two was missed in base-->

</head>

<body class="has-sidemenu overflow-hidden-x" onload="initMap()">

  <!--===============================================-->
  <!--    Fancynav-->
  <!--===============================================-->
  <nav class="fancynavbar"
    data-zanim-lg='{"from":{"opacity":1,"x":70},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}'
    data-zanim-xs='{"from":{"opacity":1,"y":-43},"to":{"opacity":1,"y":0},"ease":"CubicBezier","duration":0.8,"delay":0.3}'
    data-zanim-trigger="scroll" data-exclusive="true">
    <div class="fancynavbar-togglerbar bg-black">
		
		<a class="fancynavbar-brand" href="/index.html">
		<img
          class="fancynavbar-brand-img" src="../../wallace/images/imageonline-co-textimage_corben700.png" alt="" width="30" height="30"
          data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}'
          data-zanim-trigger="scroll" />
          
        <!--You can use icon or text logo as well-->
        <!--<span class='fab fa-superpowers fs-3'></span>-->
        <!--<span class='logo-sparrow'>S</span>-->
      </a>
      <div class="fancynavbar-toggler"><svg class="fancynavbar-toggler-icon" viewBox="0 0 70 70"
          xmlns="http://www.w3.org/2000/svg"
          data-zanim-lg='{"from":{"opacity":0,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.5}'
          data-zanim-trigger="scroll">
          <path id="path-top" d="M20,25c0,0,22,0,30,0c16,0,18.89,40.71-.15,21.75C38.7,35.65,19.9,16.8,19.9,16.8"></path>
          <path id="path-middle" d="M20,32h30"></path>
          <path id="path-bottom" d="M19.9,46.98c0,0,18.8-18.85,29.95-29.95C68.89-1.92,66,38.78,50,38.78c-8,0-30,0-30,0">
          </path>
        </svg></div>
      <div class="fancynavbar-addon"
        data-zanim-lg='{"from":{"opacity":1,"x":45},"to":{"opacity":1,"x":0},"ease":"CubicBezier","duration":0.8,"delay":0.4}'
        data-zanim-trigger="scroll">
        <a class="fancynavbar-addon-item" href="https://twitter.com/wallacemwang?s=11"><span class="fab fa-twitter"></span></a>
              <a href="#" class="nav-link fancynavbar-addon-item" data-toggle="modal" data-target="#mkdocs_search_modal">
                  <i class="fa fa-search"></i>
              </a>

        <!-- <a class="fancynavbar-addon-item" href="#languageModal"
          data-toggle="modal"><span class="text-sans-serif ls font-weight-black fs--1 d-block">EN</span></a> -->
        </div>
    </div>
    <div class="fancynavbar-collapse">
      <ul class="fancynavbar-nav">
        <!-- <li class="fancynav-item"><a class="fancynav-link" href="page-portfolio.html"><span class="fancynav-link-content">portfolio</span></a></li>
        <li class="fancynav-item"><a class="fancynav-link" href="page-contact.html"><span class="fancynav-link-content">contact</span></a></li> -->
        
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../..">
              <span class="fancynav-link-content">Home</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../projects/">
              <span class="fancynav-link-content">Projects</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../discoveries/">
              <span class="fancynav-link-content">Discoveries</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../projects_cn/">
              <span class="fancynav-link-content">研究方向</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../discoveries_cn/">
              <span class="fancynav-link-content">研究成果</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../team/">
              <span class="fancynav-link-content">Team</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../publications/">
              <span class="fancynav-link-content">Publications</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../contact/">
              <span class="fancynav-link-content">Contact</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../job_openings/">
              <span class="fancynav-link-content">Join us</span>
            </a>
          </li>
          
          
          
          <li class=" fancynav-item">
            <a class="fancynav-link" href="../../blog/">
              <span class="fancynav-link-content">Blog</span>
            </a>
          </li>
          
          
        
      </ul>
    </div>
  </nav>
  <!--===============================================-->
  <!--    End of Fancynav-->
  <!--===============================================-->


  <!-- ===============================================-->
  <!--    Main Content-->
  <!-- ===============================================-->

  <main class="main min-vh-100" id="top" style="min-height: 138vh !important;">
    <!-- <section> begin ============================-->
    
<!-- ============================================-->
<!-- Preloader ==================================-->
<div class="preloader" id="preloader">
          <div class="loader">
                    <div class="line-scale-pulse-out-rapid">
                              <div></div>
                              <div></div>
                              <div></div>
                              <div></div>
                              <div></div>
                    </div>
          </div>
</div><!-- ============================================-->
<!-- End of Preloader ===========================-->

<!-- ============================================-->
<!-- <section> begin ============================-->
<section class="py-0">
          <div class="bg-holder overlay"
                    style="background-image:url(/wallace/assets//img/headers/header-single-blog.jpg);"
                    data-zanim-xs='{"delay":0.4,"animation":"zoom-out"}' data-zanim-trigger="scroll"></div>
          <!--/.bg-holder-->
          <div class="container">
                    <div class="row align-items-end min-vh-100">
                              <div class="col-lg-8 mb-6">
                                        <h2 class="text-white display-4 fs-3 fs-md-4" data-zanim-xs='{"delay":0.6}'
                                                  data-zanim-trigger="scroll">Identity transfer and the rise of virtual
                                                  surrealism</h2>
                              </div>
                    </div>
          </div><!-- end of .container-->
</section><!-- <section> close ============================-->
<!-- ============================================-->



<!-- ============================================-->
<!-- <section> begin ============================-->
<section>
          <div class="container">
                    <div class="row">
                              <div class="col-lg-8">
                                        <h1 id="-dp">强化学习-动态规划-DP</h1>
<blockquote>
<p>作者：YJLAugus  博客： https://www.cnblogs.com/yjlaugus 项目地址：https://github.com/YJLAugus/Reinforcement-Learning-Notes，如果感觉对您有所帮助，烦请点个⭐Star。</p>
</blockquote>
<p>这里讲动态规划，主要是用动态规划来解决MDP的中最优的策略，并得出最优的价值函数。这节主要介绍两中动态规划的方法，一个是<strong>策略迭代</strong>方法，另一个是<strong>价值迭代</strong>方法。</p>
<h2 id="_1">策略迭代</h2>
<p>策略迭代主要分两个，一个是<strong>策略评估</strong>，一个是<strong>策略改进</strong>。定义比较简单，分别如下：</p>
<p><strong>策略评估</strong>：给定任意的一个 <span class="arithmatex">\(\pi\)</span> ，求出 状态价值函数 <span class="arithmatex">\(v_\pi(s)\)</span> 或者状态动作价值函数 <span class="arithmatex">\(q_\pi(s,a)\)</span>。
<strong>策略改进</strong>：依据策略评估得出来的 <span class="arithmatex">\(v_\pi(s)\)</span> 或者 <span class="arithmatex">\(q_\pi(s,a)\)</span>，从其中构造出一个新的 <span class="arithmatex">\(\pi'\)</span> ，使得 $\pi' \geq \pi $ ，这样就完成了一次迭代。
 * 换句话说，就是在每个状态下根据<span class="arithmatex">\(v_\pi(s)\)</span> 或者 <span class="arithmatex">\(q_\pi(s,a)\)</span>选择一个最优的策略，这个策略就是 <span class="arithmatex">\(\pi'\)</span> 。
 * 这种根据<code>原策略的价值函数</code>执行贪心算法，来构造一个更好策略的过程，我们称为策略改进。
<strong>策略迭代</strong>： 就是递归以上两个过程，以上面的例子，得到<span class="arithmatex">\(\pi'\)</span>的价值函数，然后再以<span class="arithmatex">\(\pi'\)</span>的价值函数构造一个新的<span class="arithmatex">\(\pi''\)</span> ，不断迭代。</p>
<h3 id="-">策略评估-解析解</h3>
<p>策略评估，就是已知 MDP，“已知MDP”的意思是知道其动态特性，也就是 <span class="arithmatex">\(p(s',r \mid s,a)\)</span>，给定<span class="arithmatex">\(\pi\)</span> ，求<span class="arithmatex">\(v_\pi(s)\)</span>。</p>
<p>已知<span class="arithmatex">\((\forall s\in S)\)</span> ，即有多少个<span class="arithmatex">\(s\)</span> 就会有多少<span class="arithmatex">\(v_\pi(s)\)</span>，可得列向量如下：
$$
\large
v_\pi(s)= \begin{pmatrix}
v_\pi(s_1)\
v_\pi(s_2)\
\vdots    \
v_\pi(s_{\lvert S \rvert})</p>
<p>\end{pmatrix} _{\lvert S \rvert \times 1}
$$</p>
<p>上节课我们得到价值函数的公式，并进一步推导得到贝尔曼期望方程：
$$
\large
{\begin{align}<br />
v_\pi(s) =&amp; E_\pi[G_t \mid S_t = s] \
=&amp; E_\pi[R_{t+1} + \gamma v_\pi(S_{t+1} \mid S_t=s)]\
=&amp; v_\pi(s) = \sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a)[r+ \gamma v_\pi(s')] 
\end{align}
}
$$
从上面的列向量中得知，如果我们想要求整个的<span class="arithmatex">\(v_\pi(s)\)</span> ，就是把<span class="arithmatex">\(v_\pi(s_1),v_\pi(s_2),v_\pi(s_3)...\)</span> 等所有的价值函数都要求出来。我们这节的目的就是把公式中的累加符号去掉，得到另一个更为简单的式子。接下来我们对下面的式子进行化简如下：
$$
\large{
\begin{align} </p>
<p>v_\pi(s) =&amp; \sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a)[r+ \gamma v_\pi(s')]\
= &amp; \underbrace {\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot r }<em A="A" a_in="a\in">{①}
+ 
\underbrace{\gamma \sum</em> \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot v_\pi(s')}_{②}</p>
<p>\end{align}
}
$$
<strong>分解①式</strong>：对于①式而言，<span class="arithmatex">\(s'\)</span> 只出现在函数<span class="arithmatex">\(p(s',r \mid s,a)\)</span> 中，是可以积分积掉的。故由①得：
$$
\large{
\begin{align}</p>
<p>\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot r  \
=&amp; \sum_{a\in A}  \pi(a\mid s) \underbrace {\sum_{r}  r\cdot p(r \mid s,a)}<em>{E</em>\pi[R_{t+1}  \mid S_t=s,A_t=a]} \quad\quad (1)  \</p>
<p>\end{align}
}
$$
（1）式正好是期望，此时我们也定义一个函数（记号） <span class="arithmatex">\(r(s,a) \dot{=} E_\pi[R_{t+1}  \mid S_t=s,A_t=a]\)</span> 。表示<span class="arithmatex">\(s,a\)</span> 这个二元组的收益。故我们的推导变成如下：
$$
\large{
\begin{align}</p>
<p>\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot r  \
=&amp; \sum_{a\in A} \pi(a\mid s) \underbrace {\sum_{r}  r\cdot p(r \mid s,a)}<em>{r(s,a) \dot{=}E</em>\pi[R_{t+1}  \mid S_t=s,A_t=a]} \quad\quad (1)  \
=&amp; \sum_{a\in A} \pi(a\mid s) \cdot r(s,a) \quad\quad\quad\quad \quad\quad \quad\quad\ (2)</p>
<p>\end{align}
}
$$
（2）式中，如果把 <span class="arithmatex">\(a\)</span> 都积分掉，那么（2）式就和<span class="arithmatex">\(a\)</span> 就没关系了，只和<span class="arithmatex">\(s\)</span> 有关，这里我们再次引入一个记号<span class="arithmatex">\(r_\pi(s)\)</span>用来表示这个新的关系如下：
$$
\large{
\begin{align}</p>
<p>\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot r  \
=&amp; \sum_{a\in A} \pi(a\mid s) \underbrace {\sum_{r}  r\cdot p(r \mid s,a)}<em>{r(s,a) \dot{=}E</em>\pi[R_{t+1}  \mid S_t=s,A_t=a]} \quad\quad (1)  \
=&amp; \sum_{a\in A} \pi(a\mid s) \cdot r(s,a) \quad\quad\quad\quad \quad\quad \quad\quad\ (2) \
\dot{=}&amp;r_\pi(s)  \quad\quad\quad\quad \quad\quad \quad\quad\quad \quad\quad\ \quad\quad \quad\quad\ (3)</p>
<p>\end{align}
}
$$
此时，①式化简至此，需要提到的一点是，<span class="arithmatex">\(r_\pi(s)\)</span> 应该由多少个呢？在一开始我们就提到过 “<span class="arithmatex">\(S\)</span>中有多少个<span class="arithmatex">\(s\)</span> 就会有多少<span class="arithmatex">\(v_\pi(s)\)</span>，” ，显然 <span class="arithmatex">\(r_\pi(s)\)</span> 的数量也是 <span class="arithmatex">\(\lvert S \rvert\)</span> 个。故可得列向量如下:
$$
\large
r_\pi(s)= \begin{pmatrix}
r_\pi(s_1)\
r_\pi(s_2)\
\vdots    \
r_\pi(s_{\lvert S \rvert})</p>
<p>\end{pmatrix} _{\lvert S \rvert \times 1}
$$
<strong>分解②式</strong>：在 <span class="arithmatex">\(p(s',r \mid s,a) \cdot v_\pi(s')\)</span> 中，我们发现 <span class="arithmatex">\(s'\)</span> 在式子中都存在，但是<span class="arithmatex">\(r\)</span> 只存在于函数 <span class="arithmatex">\(p(s',r \mid s,a)\)</span> 中，故积分可以积掉，则②式可以进一步写成：
$$
\large{
\begin{align}</p>
<p>\gamma \sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot v_\pi(s') 
=&amp; \gamma \sum_{a\in A} \pi(a\mid s) \sum_{s'}\underbrace{p(s' \mid s,a)}<em>{状态转移函数} \cdot v</em>\pi(s') \quad\quad (4)</p>
<p>\end{align}
}
$$
在（4）式中，可以发现在两个累加号中都有 <span class="arithmatex">\(a\)</span>（注：虽然也都有 <span class="arithmatex">\(s\)</span>，但是累加号下面是<span class="arithmatex">\(a\)</span> ，故积分只能积掉 <span class="arithmatex">\(a\)</span>），积分可以积掉，但是一定和 <span class="arithmatex">\(s,s'\)</span> 有关，故引出一个记号 <span class="arithmatex">\(P_\pi(s,s')\)</span> 来表示。 故继续推导如下：
$$
\large{
\begin{align}</p>
<p>\gamma \sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a) \cdot v_\pi(s') 
=&amp; \gamma \sum_{a\in A} \pi(a\mid s) \sum_{s'}\underbrace{p(s' \mid s,a)}<em>{状态转移函数} \cdot v</em>\pi(s') \quad\quad (4) \</p>
<p>=&amp; \gamma \sum_{s'} \underbrace{\sum_{a\in A} \pi(a\mid s) p(s' \mid s,a)}<em>{P</em>\pi(s,s')} \cdot v_\pi(s') \quad\quad (5) \</p>
<p>=&amp;  \gamma \sum_{s'} P_\pi(s,s') \cdot v_\pi(s') \quad\quad (6)\</p>
<p>\end{align}
}
$$
由（6）式可知，对于 <span class="arithmatex">\(P_\pi(s,s')\)</span> 来说，一共由多少个值呢？很显然，<span class="arithmatex">\(s\)</span> 和 <span class="arithmatex">\(s'\)</span> 分别由 $\lvert S \rvert $ 个值，故 <span class="arithmatex">\(P_\pi(s,s')\)</span> 会有 $\lvert S \rvert \times \lvert S \rvert  $  个。故可得矩阵如下：
$$
\large
P_\pi(s,s')= \begin{pmatrix}
P_\pi(s_1,s'<em>1) &amp; \cdots &amp; P</em>\pi(s_1,s'<em>{\lvert S \rvert})\
\vdots &amp; \ddots &amp; \vdots \
P</em>\pi(s_{\lvert S \rvert},s'<em>1) &amp; \cdots &amp; P</em>\pi(s_{\lvert S \rvert},s'_{\lvert S \rvert})\</p>
<p>\end{pmatrix} <em>{\lvert S \rvert \times \lvert S \rvert}
$$
于是，结合（3）和（6）式得：
$$
\large{
v</em>\pi(s) = r_\pi(s) + \gamma \sum_{s'} P_\pi(s,s') \cdot v_\pi(s') \quad\quad\quad (7)
}
$$
令<span class="arithmatex">\(s_i\dot{=s},s_j \dot{=} s'\)</span> ，则（7） 式得：
$$
\large{
v_\pi(s) = r_\pi(s) + \gamma \underbrace{\sum_{j=1}^{\lvert S \rvert} P_\pi(s_i,s_j) }<em>{①}\cdot v</em>\pi(s') \quad\quad\quad (7)
}
$$
由（7）式中的①式可得，正好是矩阵<span class="arithmatex">\(P_\pi(s,s')\)</span> ，其中的 <span class="arithmatex">\(P_\pi(s_i,s_j)\)</span>正是矩阵的一行。（7）式中<span class="arithmatex">\(v_\pi(s)，r_\pi(s)，①，v_\pi(s')\)</span> 式（<span class="arithmatex">\(v_\pi(s')\)</span>本质是和<span class="arithmatex">\(v_\pi(s)\)</span>是一样的），都分别对应一个矩阵，也即：
$$
\begin{pmatrix}
v_\pi(s_1)\
v_\pi(s_2)\
\vdots    \
v_\pi(s_{\lvert S \rvert})
\end{pmatrix} _{\lvert S \rvert \times 1}
=</p>
<p>\begin{pmatrix}
r_\pi(s_1)\
r_\pi(s_2)\
\vdots    \
r_\pi(s_{\lvert S \rvert})
\end{pmatrix} _{\lvert S \rvert \times 1}
+ \gamma</p>
<p>\begin{pmatrix}
P_\pi(s_1,s'<em>1) &amp; \cdots &amp; P</em>\pi(s_1,s'<em>{\lvert S \rvert})\
\vdots &amp; \ddots &amp; \vdots \
P</em>\pi(s_{\lvert S \rvert},s'<em>1) &amp; \cdots &amp; P</em>\pi(s_{\lvert S \rvert},s'<em S="S" _lvert="\lvert" _rvert="\rvert" _times="\times">{\lvert S \rvert})\
\end{pmatrix} </em>
\cdot </p>
<p>\begin{pmatrix}
v_\pi(s_1)\
v_\pi(s_2)\
\vdots    \
v_\pi(s_{\lvert S \rvert})
\end{pmatrix} <em>{\lvert S \rvert \times 1}
$$
最终化简到矩阵的运算。故，由（7）式进一步得：
$$
\large{
\begin{align}
v</em>\pi(s) =&amp; r_\pi(s) + \gamma P_\pi(s,s') \cdot v_\pi(s') \quad\quad\quad \
v_\pi=&amp; r_\pi + \gamma P_\pi \cdot v_\pi \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\qquad (8)\
(I-P_\pi)v_\pi =&amp; r_\pi \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\qquad\quad\quad\quad\quad\quad\ (9) \
v_\pi =&amp; (I-P_\pi)^{-1} r_\pi \qquad\qquad\qquad\qquad\qquad\qquad(10)
\end{align}
}
$$
经过以上推导，得出（10）式。其中在（8）式中<span class="arithmatex">\(v_\pi(s')\)</span> 其实是 <span class="arithmatex">\(v_\pi(s)\)</span> 的迭代，所以直接用 <span class="arithmatex">\(v_\pi(s)\)</span> 替换，在（9）式中<span class="arithmatex">\(\gamma\)</span> 是个常数，也可忽略。从向量中可以得出复杂度<span class="arithmatex">\(O({\lvert S \rvert}^3)\)</span></p>
<h3 id="summary">Summary</h3>
<p><img alt="image-20201203135011156" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203135011156.png" /></p>
<h3 id="-_1">策略评估-迭代解</h3>
<p>首先，我们来看如何使用动态规划来求解强化学习的<strong>预测问题</strong>，即求解给定策略的状态价值函数的问题。这个问题的求解过程我们通常叫做策略评估(Policy Evaluation)。</p>
<p>策略评估的基本思路是从<strong>任意一个状态价值函数开始</strong>，依据给定的策略，结合贝尔曼期望方程、状态转移概率和奖励同步迭代更新状态价值函数，直至其<strong>收敛</strong>，得到该策略下最终的状态价值函数。</p>
<p>假设我们在第<span class="arithmatex">\(k\)</span>轮迭代已经计算出了所有的状态的状态价值，那么在第<span class="arithmatex">\(k+1\)</span>轮我们可以利用第<span class="arithmatex">\(k\)</span>轮计算出的<strong>状态价值</strong>计算出第<span class="arithmatex">\(k+1\)</span>轮的状态价值。这是通过贝尔曼方程来完成的，即：
$$
\large{
v_{k+1}(s) = \sum\limits_{a \in A} \pi(a|s)(R_s^a + \gamma \sum\limits_{s' \in S}P_{ss'}^av_{k}(s'))
 \</p>
<p>v_{k+1}(s) \dot{=}\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a)[r+ \gamma v_k(s')]
}
$$
和上一节的式子唯一的区别是由于我们的策略<span class="arithmatex">\(\pi\)</span>已经给定，我们不再写出，对应加上了迭代轮数的下标。我们每一轮可以对计算得到的新的状态价值函数再次进行迭代，直至状态价值的值改变<strong>很小(收敛)</strong>，那么我们就得出了预测问题的解，即给定策略的状态价值函数<span class="arithmatex">\(v_\pi\)</span>。</p>
<h3 id="summary_1">Summary</h3>
<p><img alt="image-20201203183436771" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203183436771.png" /></p>
<h3 id="-_2">策略评估-（迭代解）应用</h3>
<p>下面我们用一个具体的例子来说明策略评估的过程。</p>
<p><img alt="image-20201203142402216" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203142402216.png" /></p>
<p>这是一个经典的Grid World的例子。我们有一个<code>4x4</code>的16宫格。只有左上和右下的格子是终止格子。该位置的价值固定为0，个体如果到达了该2个格子，则停止移动，此后每轮奖励都是0。个体在16宫格其他格的每次移动，得到的即时奖励R都是-1。注意个体每次只能移动一个格子，且只能上下左右4种移动选择，不能斜着走, 如果在边界格往外走，则会直接移动回到之前的边界格。衰减因子我们定义为<span class="arithmatex">\(\gamma =1\)</span>。由于这里每次移动，下一格都是固定的，因此所有可行的的状态转化概率<span class="arithmatex">\(P =1\)</span>。这里给定的策略是随机策略，即每个格子里有25%的概率向周围的4个格子移动。</p>
<p><img alt="image-20201203142716568" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203142716568.png" /></p>
<p>首先我们初始化所有格子的状态价值为0，如上图<span class="arithmatex">\(k=0\)</span>的时候。现在我们开始策略迭代了。由于终止格子的价值固定为0，我们可以不将其加入迭代过程。</p>
<p><strong>在<span class="arithmatex">\(k=1\)</span>时</strong>，我们利用上面的贝尔曼方程先计算第二行第一个格子的价值：
$$
v_1^{(21)} = \frac{1}{4}[(-1+0) +(-1+0)+(-1+0)+(-1+0)] = -1
$$
第二行第二个格子的价值是：
$$
v_1^{(22)} = \frac{1}{4}[(-1+0) +(-1+0)+(-1+0)+(-1+0)] = -1
$$
其他的格子都是类似的，第一轮的状态价值迭代的结果如上图<span class="arithmatex">\(k=1\)</span>的时候。现在我们第一轮迭代完了。</p>
<p><strong>在<span class="arithmatex">\(k=1\)</span>时</strong>，还是看第二行第一个格子的价值：
$$
v_2^{(21)} = \frac{1}{4}[(-1+0) +(-1-1)+(-1-1)+(-1-1)] = -1.75
$$
第二行第二个格子的价值是：
$$
v_2^{(22)} = \frac{1}{4}[(-1-1) +(-1-1)+(-1-1)+(-1-1)] = -2
$$
最终得到的结果是上图<span class="arithmatex">\(k=2\)</span>的时候，第二轮迭代完毕。</p>
<p><img alt="image-20201203142745214" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203142745214.png" /></p>
<p><strong>在<span class="arithmatex">\(k=3\)</span>时</strong>：
$$
v_3^{(21)} = \frac{1}{4}[(-1+0)+(-1-1.7) +(-1-2)+(-1-2)] = -2.425 \
v_3^{(22)} = \frac{1}{4}[(-1-1.7) +(-1-1.7)+(-1-2)+(-1-2)] = -2.85
$$</p>
<blockquote>
<p>计算加和的过程 就是 上、下、左、右四个方向，其中无论哪次迭代，都有 <span class="arithmatex">\(v_k^{11} = 0\)</span>。</p>
</blockquote>
<p>最终得到的结果是上图<span class="arithmatex">\(k=3\)</span>的时候。就这样一直迭代下去，直到每个格子的策略价值改变很小（收敛）为止。这时我们就得到了所有格子的基于随机策略的状态价值。</p>
<p>可以看到，动态规划的策略评估计算过程并不复杂，但是如果我们的问题是一个非常复杂的模型的话，这个计算量还是非常大的。</p>
<h3 id="-_3">策略改进-策略改进定理</h3>
<p>现在出现了这样一个问题，如果给定一个 <span class="arithmatex">\(\pi\)</span> 和 <span class="arithmatex">\(\pi'\)</span> ，我们如何判断哪一策略更好呢？采用我们以前提到的方法，就是分别计算各自对应的价值函数，然后通过判断两个价值函数的大小来判断策略的好坏。虽然能够得出结论，但是这个计算的过程也是会占用 “资源”的，能否有另外一种方式可以实现相应的功能呢？有，那就是<strong>策略改进定理。</strong></p>
<p><strong>策略改进定理：</strong> <strong>给定<span class="arithmatex">\(\pi，\pi'\)</span>，如果<span class="arithmatex">\(\forall(s) \in S,q_\pi(s,\pi'(s)) \geq v_\pi(s)\)</span>，那么，则有 <span class="arithmatex">\(\forall s\in S,v_{\pi'}(s) \geq v_\pi(s)\)</span>。</strong></p>
<p>通过上面的定理可得，<span class="arithmatex">\(q_\pi(s,a)\)</span> 只要算出来了，那么 <span class="arithmatex">\(v_\pi(s)\)</span> 自然也会得出（<span class="arithmatex">\(v_\pi(s)\)</span> 是<span class="arithmatex">\(q_\pi(s,a)\)</span>的加权平均），此时我们不再需要再求得 <span class="arithmatex">\(v_{\pi'}(s)\)</span>，而是直接把<span class="arithmatex">\(\pi'(s)\)</span> 带入到 <span class="arithmatex">\(q_\pi(s,a)\)</span> 中的a中即可。</p>
<p>下面进行定理的一个证明：</p>
<p>在 <span class="arithmatex">\(q_\pi(s,\pi'(s)) \geq v_\pi(s)\)</span> 中，里面的 <span class="arithmatex">\(q_\pi(s,a)\)</span> 和 <span class="arithmatex">\(v_\pi(s')\)</span> 有如下关系，我们在第一张MDP已经证明过：
$$
\large{
\begin{align}
q_\pi(s,a) =&amp; \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_\pi(s')] \
=&amp;E_\pi[R_{t+1} + \gamma v_\pi(s_{t+1}) \mid S_t = s, A_t=a]
\end{align}
}
$$
其实，这里需要说明一点，上式中 <span class="arithmatex">\(E_\pi\)</span> 中的<span class="arithmatex">\(\pi\)</span> 严格意义上是不能带着的，对于<span class="arithmatex">\(R_{t+1}\)</span> ， 不是<span class="arithmatex">\(\pi\)</span> 控制的，详情看下图的蓝色虚线（在第一章中，我们称其未系统之间的状态转移），</p>
<p><img alt="image-20201128135658979" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/hss02.svg" /></p>
<p>当然了，对于 <span class="arithmatex">\(R_{t+2}, R_{t+3}\)</span> 等是需要 <span class="arithmatex">\(\pi\)</span> 控制的，在公式中的体现就是<span class="arithmatex">\(v_\pi\)</span>。故，这里准确写法应该如下：
$$
\large{
\begin{align}
q_\pi(s,a) =&amp; \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_\pi(s')] \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=a]
\end{align}
}
$$
<strong>证明：</strong><span class="arithmatex">\(\forall(s) \in S,q_\pi(s,\pi'(s)) \geq v_\pi(s)\)</span>，把 <span class="arithmatex">\(a=\pi'(s)\)</span> 带入得：
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad (2)</p>
<p>\end{align}
}
$$
上面式子中，在（2）式中，我们把 <span class="arithmatex">\(\pi'\)</span>那个策略定义到 <span class="arithmatex">\(R_{t+1}\)</span> 上，其余的还是采取 <span class="arithmatex">\(\pi\)</span> 的策略。在（2）式中出现了 <span class="arithmatex">\(v_\pi(s_{t+1})\)</span> ，再带入<span class="arithmatex">\(v_\pi(s) \leq q_\pi(s,\pi'(s))\)</span>  得：
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad\ (2) \</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma q_\pi(S_{t+1},\pi'(S_{t+1})) \mid S_t = s] \quad\quad\quad\quad\quad\ (3)</p>
<p>\end{align}
}
$$
再把<span class="arithmatex">\(q_\pi(s_{t+1},\pi'(s_{t+1}))\)</span> 带入（2）式得：
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad\ (2) \</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma q_\pi(S_{t+1},\pi'(S_{t+1})) \mid S_t = s] \quad\quad\quad\quad\quad\ (3) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} + \gamma v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (4)</p>
<p>\end{align}
}
$$
有一点注意，在（4）式中 <span class="arithmatex">\(S_{t+1}\)</span> 没有写成等于多少的形式，这里只是对于<span class="arithmatex">\(S_{t+2}\)</span> 的前提条件，表明其不能独立出现。然后再对（4）展开得：
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad\ (2) \</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma q_\pi(S_{t+1},\pi'(S_{t+1})) \mid S_t = s] \quad\quad\quad\quad\quad\ (3) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} + \gamma v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (4) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} \mid S_{t+1}] + \gamma^2 E_{\pi'}[v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (5)</p>
<p>\end{align}
}
$$
对于（5）式，出现了“期望套期望”，期望的期望还是期望，并且都是 <span class="arithmatex">\(E{\pi'}\)</span>，故（5）式可以进一步化简得：
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad\ (2) \</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma q_\pi(S_{t+1},\pi'(S_{t+1})) \mid S_t = s] \quad\quad\quad\quad\quad\ (3) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} + \gamma v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (4) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} \mid S_{t+1}] + \gamma^2 E_{\pi'}[v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (5) \</p>
<p>=&amp;E_{\pi'}[R_{t+1} + \gamma R_{t+2}  + \gamma^2v_\pi(S_{t+2}) \mid S_t=s ]\quad\quad\ (6)</p>
<p>\end{align}
}
$$
到这里，只走了两步，可以看到，由 <span class="arithmatex">\(\pi'\)</span> 一开始的只控制 <span class="arithmatex">\(R_{t+1}\)</span> ，走完两步后，<span class="arithmatex">\(R_{t+2}\)</span> 也属于 <span class="arithmatex">\(\pi'\)</span> 控制，接下来继续走的话，<span class="arithmatex">\(\pi'\)</span> 控制的 <span class="arithmatex">\(R\)</span> 会越来越多，<span class="arithmatex">\(\pi\)</span> 控制的 <span class="arithmatex">\(R\)</span> 越来越少。
$$
\large{
\begin{align}
v_\pi(s) \leq &amp; q_\pi(s,\pi'(s)) \
=&amp; E[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s, A_t=\pi'(s)] \quad\quad\quad(1) \
=&amp; E_{\pi'}[R_{t+1} + \gamma v_\pi(S_{t+1}) \mid S_t = s] \quad\quad\quad\quad\quad\quad\quad\quad\ (2) \</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma q_\pi(S_{t+1},\pi'(S_{t+1})) \mid S_t = s] \quad\quad\quad\quad\quad\ (3) \</p>
<p>=&amp; E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} + \gamma v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (4) \</p>
<p>=&amp; E_{\pi'}[R_{t+1} + \gamma E_{\pi'}[R_{t+2} \mid S_{t+1}] + \gamma^2 E_{\pi'}[v_\pi(S_{t+2}) \mid S_{t+1}] \mid S_t=s ]\quad\quad\ (5) \</p>
<p>=&amp; E_{\pi'}[R_{t+1} + \gamma R_{t+2}  + \gamma^2v_\pi(S_{t+2}) \mid S_t=s ]\quad\quad\ (6)\</p>
<p>\leq &amp; E_{\pi'}[R_{t+1} + \gamma R_{t+2}  +\gamma^2 R_{t+3} + \gamma^3v_\pi(S_{t+3}) \mid S_t=s ]\quad\quad\quad (7)\</p>
<p>\vdots \</p>
<p>\leq &amp; E_{\pi'} \underbrace{[R_{t+1} + \gamma R_{t+2}  +\gamma^2 R_{t+3} + \gamma^4 R_{t+4} + \cdots}_{G_t} \mid S_t=s ] \quad\quad\ (8)\ </p>
<p>=&amp; v_{\pi'}(s)</p>
<p>\end{align}
}
$$
故得到：<span class="arithmatex">\(v_\pi'(s) \geq v_\pi(s)\)</span>， 得证。</p>
<h3 id="summary_2">Summary</h3>
<p><img alt="image-20201203210853298" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201203210853298.png" /></p>
<h3 id="-_4">策略改进-贪心策略</h3>
<p>这节就是利用策略改进定理提出一种策略改进的方法——<strong>贪心策略</strong>（Greedy Policy）。对于 <span class="arithmatex">\(\forall s \in S\)</span>，定义如下公式：
$$
\large{
\pi'(s) = \underset{a}{argmax}\ q_\pi(s,a) \quad\quad (1)
}
$$
上面式子的意识是说，根据我们上节课所说的，从一个策略<span class="arithmatex">\(\pi\)</span>，经过策略评估得到一些 <span class="arithmatex">\(\pi'\)</span> ，如下图所示。并从这些 <span class="arithmatex">\(\pi'\)</span> 中选择一个最大的<span class="arithmatex">\(q_\pi(s,a)\)</span>。<span class="arithmatex">\(\underset{a}{argmax}\)</span> 表示能够使得表达式的值最大化的 <span class="arithmatex">\(a\)</span>。</p>
<p><img alt="" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/pe.svg" /></p>
<p>由在第一章讲到的 <span class="arithmatex">\(v_\pi(s)\)</span> 和 <span class="arithmatex">\(q_\pi(s,a)\)</span> 的 关系得：<span class="arithmatex">\(v_\pi(s) \leq \underset{a}max \ q_\pi(s,a)\)</span> 。又因由（1）式可得， <span class="arithmatex">\(q_\pi(s,\pi'(s)) = \underset{a}max \ q_\pi(s,a)\)</span> 故得：
$$
\large{
v_\pi(s) \leq \underset{a}max \ q_\pi(s,a) =q_\pi(s,\pi'(s)) \
v_\pi(s) \leq q_\pi(s,\pi'(s)) \quad\quad\quad \quad \qquad\quad\quad \qquad\quad\quad
(2)
}
$$
（2）式正好满足上节我们说的策略改进定理。<strong>故由策略定理得知：对于 <span class="arithmatex">\(\forall s \in S\)</span>，<span class="arithmatex">\(v_{\pi'}(s) \geq v_\pi(s)\)</span>。</strong></p>
<p>如果在某一个时刻，一直迭代，如果出现了 $ v_\pi(s)=v_{\pi'}(s)$ ，这种情况，也就是说明 <span class="arithmatex">\(v_\pi(s)\)</span> 此时已经不能再好了，并且此时$ v_\pi(s)=v_{\pi'}(s) =v_*$。如下图所示：</p>
<p><img alt="" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/veq.svg" /></p>
<blockquote>
<p><strong>证明</strong>：如果<span class="arithmatex">\(v_{\pi'}=v_\pi\)</span> 那么，$ v_\pi(s)=v_{\pi'}(s) =v_*$</p>
</blockquote>
<p>证：由 <span class="arithmatex">\(v_{\pi'}=v_\pi\)</span>， 可以得出 <span class="arithmatex">\(q_{\pi'}=q_\pi。\)</span><span class="arithmatex">\(\forall s\in S\)</span>，由$v_\pi(s) = \sum_{a\in A} \pi(a\mid s) ·q_\pi(s,a) $可得：
$$
\large{
\begin{align}
v_{\pi'}(s) =&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi'}(s,a)\
=&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi}(s,a) \quad\quad\quad\ (3) \  </p>
<p>\end{align}
}
$$
因为前面说的 <span class="arithmatex">\(\pi'\)</span> 都是选择一个最优的策略，也就是<strong>确定性策略</strong>，如下图所示：</p>
<p><img alt="image-20201128135658979" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/hss02.svg" /></p>
<p>假如我们选择<code>a3</code>这个策略为 <span class="arithmatex">\(\pi'\)</span> 。故在（3）式中的加和可以去掉了，因为是确定性策略，那么选择<code>a2</code> 和 <code>a1</code>的概率就是0，例缩当然加和后只剩下<code>a3</code> 这个策略<span class="arithmatex">\(\pi'\)</span>，故继续推导得：
$$
\large{
\begin{align}
v_{\pi'}(s) =&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi'}(s,a)\
=&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi}(s,a) \quad\quad\quad\ (3) \
=&amp; q_\pi(s,\pi'(s)) \quad\quad\quad\quad\quad\quad\quad\quad\ (4)  \</p>
<p>\end{align}
}
$$
由（4）式和（2）中<span class="arithmatex">\(\underset{a}max \ q_\pi(s,a) =q_\pi(s,\pi'(s))\)</span> 得：
$$
\large{
\begin{align}
v_{\pi'}(s) =&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi'}(s,a)\
=&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi}(s,a) \quad\quad\quad\ (3) \
=&amp; q_\pi(s,\pi'(s)) \quad\quad\quad\quad\quad\quad\quad\quad\quad (4)  \
=&amp; \underset{a}max \ q_\pi(s,a) \qquad\quad\quad\quad\quad\quad\quad\ (5)\</p>
<p>\end{align}
}
$$
（5）式再由$q_\pi(s,a) =\sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_\pi(s')] $ 可得：
$$
\large{
\begin{align}
v_{\pi'}(s) =&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi'}(s,a)\
=&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi}(s,a) \quad\quad\quad\ (3) \
=&amp; q_\pi(s,\pi'(s)) \quad\quad\quad\quad\quad\quad\quad\quad\quad (4)  \
=&amp; \underset{a}max \ q_\pi(s,a) \qquad\quad\quad\quad\quad\quad\quad\ (5)\
=&amp; \underset{a}max \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_\pi(s')] \quad (6) \
\end{align}
}
$$
在（6）式中，又因为题设中，<span class="arithmatex">\(v_{\pi'}=v_\pi\)</span> 故带入得：
$$
\large{
\begin{align}
v_{\pi'}(s) =&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi'}(s,a)\
=&amp; \sum_{a\in A} {\pi'}(a\mid s) ·q_{\pi}(s,a) \quad\quad\quad\ (3) \
=&amp; q_\pi(s,\pi'(s)) \quad\quad\quad\quad\quad\quad\quad\quad\quad (4)  \
=&amp; \underset{a}max \ q_\pi(s,a) \qquad\quad\quad\quad\quad\quad\quad\ (5)\
=&amp; \underset{a}max \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_\pi(s')] \quad (6) \
=&amp; \underset{a}max \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_{\pi’}(s')] \quad (7)
\end{align}
}
$$
故此时我们得到：
$$
\large
v_{\pi'}(s) = \underset{a}max \sum_{s',r}P(s',r \mid s,a)[r+ \gamma v_{\pi’}(s')] \quad(8)
$$
并且我们由贝尔曼最优方程得：
$$
\large{
v_*(s)=\underset{a}{max}\sum_{s',r}P(s',r \mid s,a)[r+\gamma v_\pi(s')] \quad\quad(9) \</p>
<p>}
$$
故由（8）式和（9）式，以及题设<span class="arithmatex">\(v_{\pi'}=v_\pi\)</span> 得证：
$$
 \large
 v_\pi(s)=v_{\pi'}(s) =v_*
$$</p>
<h3 id="summary_3">Summary</h3>
<p><img alt="image-20201205145118572" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201205145118572.png" /></p>
<h2 id="_2">价值迭代</h2>
<h3 id="_3">策略迭代的缺点</h3>
<p><img alt="image-20201205150228362" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201205150228362.png" /></p>
<p>从上图可以发现，在策略迭代中， 其实进行了两次策略循环，第一层是在策略评估中，第二层是策略迭代这一层。故，如果迭代次数过多的化，其实是很低效率的。<strong>策略评估的一个缺点是每一次迭代过程中都涉及了策略评估。</strong></p>
<h3 id="_4">价值迭代</h3>
<p>根据以上， 这里我们讨论一种极端的情况，只计算第一次的价值函数 <span class="arithmatex">\(v_1(s)\)</span>， 从此进行截断，后续不在计算，也即是说，只对 <span class="arithmatex">\(v_1(s)\)</span> 进行策略评估，并把这个算法称为<strong>价值迭代</strong>。如图：</p>
<p><img alt="" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/jieduan1.svg" /></p>
<p>如下图所示，价值迭代只计算 从状态<span class="arithmatex">\(s\)</span> 到<span class="arithmatex">\(s'\)</span>的一条分支（<span class="arithmatex">\(v_1(s)\)</span>），假定以最右侧分支为例，这是策略评估的<strong>一步</strong>，加上策略改进后，其实只走了“半步”，也就是从<span class="arithmatex">\(s\)</span> 状态走到a3（假定选择了action a3），此时利用策略改进算法即可用a3处的<span class="arithmatex">\(q_\pi(s,a)\)</span> ，并得到<span class="arithmatex">\(v_\pi(s)\)</span> 和 <span class="arithmatex">\(v_{\pi'}(s)\)</span>的大小关系，以下图为例，假设a3为<span class="arithmatex">\(v_\pi(s)\)</span>，则a2或者a1就是<span class="arithmatex">\(v_{\pi'}(s)\)</span>。</p>
<p>也即：如果按照策略迭代的方法，需要计算完所有v1（选择a1的<span class="arithmatex">\(v_\pi(s)-&gt;v_{\pi'}(s)\)</span>），v2，v3，如上图所示。但是依据价值迭代 + 策略改进，只需要计算v1的“半步”即可，因为根据策略改进定理，只需要计算出<span class="arithmatex">\(q_\pi(s,a)\)</span>，即可得出<span class="arithmatex">\(v_\pi(s)\)</span> 和 <span class="arithmatex">\(v_{\pi'}(s)\)</span>的大小关系。</p>
<p><img alt="image-20201128135658979" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/hss02.svg" /></p>
<p>从 <strong>策略评估-（迭代解）应用</strong>小节 中可以知道，这个会有多个v1（注意：v1指的是多个状态，比如<span class="arithmatex">\(v1^{21}\)</span>是第一次迭代中第二行第一个格子的状态，这里的“1”其实指的是迭代次数，并不一个状态）, 在这里选一个最大<span class="arithmatex">\(v_\pi\)</span>作为<span class="arithmatex">\(v*\)</span> 。即完成了一次迭代。下面的公式，其是正是贝尔曼最优方程（求<span class="arithmatex">\(v*\)</span> ，<span class="arithmatex">\(q*\)</span>）的 求<span class="arithmatex">\(v*\)</span>的过程，同时也是价值迭代的算法公式：
$$
\large{
 v_{k+1}(s) \dot{=}\underset{a}{max} \sum_{s',r}p(s',r \mid s,a)[r+ \gamma v_k(s') \quad\quad(1)
}
$$
从上面（1）式中，从贝尔曼最优方程的较多来说，这里变成<strong>了一条更新规则</strong>，还是以<strong>策略评估-（迭代解）应用</strong>小节的例子举例，只计算v1，把“每个格子”的数据更新了一次（第一次迭代得到v1），而不需要在根据v1的数据j计算v2，再进行更新了。</p>
<p>除此之外，可以把（1）式和 “<strong>策略评估-迭代解</strong>”的更新策略$ v_{k+1}(s) \dot{=}\sum_{a\in A} \pi(a\mid s) \sum_{s',r}p(s',r \mid s,a)[r+ \gamma v_k(s')]$比较，唯一不同的是，在策略评估-迭代解中，对于 <span class="arithmatex">\(s\)</span>状态的下一步<code>action</code> 需要根据概率求得，而在价值迭代中，直接在v1中选择最大的<code>action</code>，故概率此时为1。即：<strong>价值迭代是极端情况下的策略迭代</strong>。</p>
<p>根据上面描述的极端情况，其实就是价值迭代，总结如下：</p>
<p><img alt="image-20201205213726436" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201205213726436.png" /></p>
<h3 id="_5">异步动态规划</h3>
<p>异步动态规划，也叫就地迭代，它是基于价值迭代的一种算法。在样本空间比较大的情况下，即使只进行一次迭代，也会花费很长的时间，还是以<strong>策略评估-（迭代解）应用</strong> 小节的例子，比如下图：</p>
<p><img alt="image-20201205220225280" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201205220225280.png" /></p>
<p>如果，格子的数量及其多，即使只计算v1，（更新一次），迭代一次，花费时间也是巨大的。所以就出现了一种算法，这种算法，只随机找到“其中的一个格子” 进行更新，这就是<strong>异步动态规划</strong>。然而，为了收敛，异步算法必须不断的更新所有状态的值。</p>
<h2 id="_6">广义策略迭代</h2>
<p>广义策略迭代，其实就包含了前面所说的一般的策略迭代，价值迭代，还有就地迭代。如下面的图，如果都走到“顶”，那就是一般的策略迭代。如果走不到“顶”就可能是其他的迭代。</p>
<p><img alt="image-20201205221614255" src="https://raw.githubusercontent.com/zhaohongqiangsoliva/zhaohongqiangsoliva.github.io/master/_posts/img/image-20201205221614255.png" /></p>
<p>按照下面的例子和类比，就很容易理解了，可以把这个广义策略迭代类比买房：</p>
<p><strong>策略迭代</strong>：全款买房，以旧换新。</p>
<p><strong>价值迭代</strong>：首付，以旧换新。</p>
<p><strong>就地策略迭代</strong>：几乎0首付，以旧换新。</p>
<h2 id="_7">参考文献</h2>
<p>https://www.cnblogs.com/pinard/p/9463815.html</p>
<p>https://www.bilibili.com/video/BV1nV411k7ve?t=1738</p>
<p>https://www.davidsilver.uk/wp-content/uploads/2020/03/DP.pdf</p>
<p>http://www.incompleteideas.net/book/the-book.html</p>
                                        <!-- <div class="row">
                                                  <div class="col-12">
                                                            <div class="row">
                                                                      <div class="col"><a class="text-sans-serif text-500"
                                                                                          href="#">May 15, 2018</a>
                                                                      </div>
                                                                      <div
                                                                                class="col ml-auto text-sans-serif text-right">
                                                                                <a class="mr-3 text-500" href="#"><span
                                                                                                    class="fas fa-heart mr-1 text-danger"></span>14</a><a
                                                                                          class="text-500"
                                                                                          href="#"><span
                                                                                                    class="far fa-comment mr-1"></span>12</a>
                                                                      </div>
                                                            </div>
                                                            <h3 class="mt-4">What selfies mean for avatars in VR and the
                                                                      way we perceive ourselves</h3>
                                                            <p class="mt-4">You just landed in Paris, the euro trip
                                                                      you’ve always dreamed of! After fighting with the
                                                                      street signs and foreign language, you finally
                                                                      exchange keys and smiles with your Airbnb host and
                                                                      drop off your bags.</p><img
                                                                      class="d-block mt-5 w-100"
                                                                      src="/wallace/assets//img/blog-single-01.jpg" alt="">
                                                            <p class="mt-4">The first thing you do is visit the Eiffel
                                                                      Tower, which has been tempting you the whole time,
                                                                      peeking through the city’s legendary architecture.
                                                                      As you walk up to it, you see the familiar yet
                                                                      astonishing structure, defying you with its scale.
                                                                      There it is — you’ve seen it in pictures countless
                                                                      times, but this is different.</p>
                                                            <p class="mt-4">You’re there. There are no screens between
                                                                      you and The Tower. You can touch it, step on it,
                                                                      and most importantly, prove that you were there.
                                                                      You can’t wait to tell all your friends how
                                                                      marvelous it is. So, you reach inside your pocket
                                                                      and take out your most trusted travel companion:
                                                                      the camera phone.</p>
                                                            <p
                                                                      class="pl-4 my-6 border-left border-500 border-2x font-italic font-weight-normal gray-600 lead">
                                                                      When shopping around for other companies that
                                                                      would allow Richard to keep his pride, he comes
                                                                      across the forward-thinking Flutterbug, who wants
                                                                      Richard to lead engineering on a fantastical new
                                                                      technology that seems poised to change the world.
                                                                      That technology, of course, allows you to look in
                                                                      a camera that puts a fake mustache on your face.
                                                            </p>
                                                            <p class="mt-4">But, it’s important to recognize that
                                                                      Identity Transfer is appealing to many because it
                                                                      washes away the mundanity of their reality and
                                                                      places them as the protagonist of a newly found,
                                                                      unbounded environment, ripe for creativity.</p>
                                                            <p class="mt-4">No longer are you beholden by the
                                                                      unremarkable reality that surrounds you. Instead,
                                                                      you can now virtually inhabit any environment and
                                                                      bring along the things that make you<i>you</i>.
                                                            </p>
                                                            <div class="my-6">
                                                                      <div class="row">
                                                                                <div class="col-5 pr-1"><a
                                                                                                    href="/wallace/assets//img/single-blog-01.jpg"
                                                                                                    data-fancybox="group"
                                                                                                    data-caption="Image caption"><img
                                                                                                              class="rounded w-100 h-100 fit-cover"
                                                                                                              src="/wallace/assets//img/single-blog-01.jpg"
                                                                                                              alt=""></a>
                                                                                </div>
                                                                                <div class="col-7 pl-1"><a
                                                                                                    href="/wallace/assets//img/single-blog-02.jpg"
                                                                                                    data-fancybox="group"
                                                                                                    data-caption="Image caption"><img
                                                                                                              class="rounded w-100 h-100 fit-cover"
                                                                                                              src="/wallace/assets//img/single-blog-02.jpg"
                                                                                                              alt=""></a>
                                                                                </div>
                                                                      </div>
                                                                      <div class="row mt-2">
                                                                                <div class="col-6 pr-1"><a
                                                                                                    href="/wallace/assets//img/single-blog-03.jpg"
                                                                                                    data-fancybox="group"
                                                                                                    data-caption="Image caption"><img
                                                                                                              class="rounded w-100 h-100 fit-cover"
                                                                                                              src="/wallace/assets//img/single-blog-03.jpg"
                                                                                                              alt=""></a>
                                                                                </div>
                                                                                <div class="col-6 pl-1"><a
                                                                                                    href="/wallace/assets//img/single-blog-04.jpg"
                                                                                                    data-fancybox="group"
                                                                                                    data-caption="Image caption"><img
                                                                                                              class="rounded w-100 h-100 fit-cover"
                                                                                                              src="/wallace/assets//img/single-blog-04.jpg"
                                                                                                              alt=""></a>
                                                                                </div>
                                                                      </div>
                                                            </div>
                                                            <p class="mt-4">In The Chemical Brothers’ music video ‘Wide
                                                                      Open', Dom &amp; Nic explore a surprisingly
                                                                      captivating motion capture technique where the
                                                                      main character slowly reveals a body made of a
                                                                      synthetic, see-through material that is then
                                                                      anthropomorphized through the masterful dance of
                                                                      Sonoya Mizuno.</p>
                                                            <p class="mt-4">Thanks to Gabriel Valdivia. Original post:<a
                                                                                href="https://artplusmarketing.com/identity-transfer-and-the-rise-of-virtual-surrealism-bac751e6342c"
                                                                                target="_blank">Identity Transfer And
                                                                                The Rise Of Virtual Surrealism</a></p>
                                                            <div class="row mt-5 fs-1 align-items-center">
                                                                      <div class="col-auto">
                                                                                <h6 class="mb-0">Share on</h6>
                                                                      </div>
                                                                      <div class="col"><a class="text-facebook"
                                                                                          href="#"><span
                                                                                                    class="fab fa-facebook"></span></a><a
                                                                                          class="text-twitter"
                                                                                          href="#"><span
                                                                                                    class="fab fa-twitter ml-2"></span></a><a
                                                                                          class="text-google-plus"
                                                                                          href="#"><span
                                                                                                    class="fab fa-google-plus-square ml-2"></span></a>
                                                                      </div>
                                                            </div>
                                                            <div class="mt-6"><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Creativity</a><a
                                                                                class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Ideas</a><a
                                                                                class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Travel</a><a
                                                                                class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Art</a><a
                                                                                class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Life</a><a
                                                                                class="btn btn-xs btn-outline-secondary m-1"
                                                                                href="#">Music</a></div>
                                                  </div>
                                                  <div class="col-12 mt-6">
                                                            <div class="bg-light p-5 rounded">
                                                                      <div
                                                                                class="row no-gutters justify-content-center text-center text-sm-left">
                                                                                <div
                                                                                          class="col-6 col-sm-4 col-md-3 col-lg-4 col-xl-3 align-self-center pr-sm-3 pb-3 pb-sm-0">
                                                                                          <img class="rounded-circle img-fluid"
                                                                                                    src="/wallace/assets//img/author.jpg"
                                                                                                    alt="">
                                                                                </div>
                                                                                <div class="col-sm">
                                                                                          <h5>Sophia Olivia</h5>
                                                                                          <p class="text-sans-serif">
                                                                                                    Managing director at
                                                                                                    little Themewagon,
                                                                                                    author, media
                                                                                                    junkie, sports fan.
                                                                                                    I spend most of my
                                                                                                    time thinking about
                                                                                                    the impact
                                                                                                    technology is having
                                                                                                    on our society.</p>
                                                                                          <a class="text-sans-serif fs--1 font-weight-black text-black"
                                                                                                    href="#">Follow @
                                                                                                    twitter</a>
                                                                                </div>
                                                                      </div>
                                                            </div>
                                                  </div>
                                                  <div class="col-12 mt-8">
                                                            <h3 class="mb-4">More from Web design</h3>
                                                  </div>
                                                  <div class="col-lg-4"><img class="rounded img-fluid"
                                                                      src="/wallace/assets//img/blog-1.jpg" alt="">
                                                            <h5 class="mt-3">How to make the shame out of self-promotion
                                                                      totally insane!</h5>
                                                  </div>
                                                  <div class="col-lg-4 mt-4 mt-lg-0"><img class="rounded img-fluid"
                                                                      src="/wallace/assets//img/blog-2.jpg" alt="">
                                                            <h5 class="mt-3">Magic. My Macbook has been stolen.</h5>
                                                  </div>
                                                  <div class="col-lg-4 mt-4 mt-lg-0"><img class="rounded img-fluid"
                                                                      src="/wallace/assets//img/blog-3.jpg" alt="">
                                                            <h5 class="mt-3">How to make the shame out of self-promotion
                                                                      totally insane!</h5>
                                                  </div>
                                        </div> -->
                              </div>
                              <div class="col-lg-4 mt-6 mt-lg-0 pl-xl-7">
                                        <div class="row px-2">
                                                  <div class="col">
                                                            <h5><a href="/about/">ABOUT</a></h5>
                                                            <div class="short-about">

                                                                      <a href="/about">
                                                                                <img class="rounded w-100 fit-cover"
                                                                                          src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" />
                                                                      </a>


                                                                      <p>Goals determine what you going to be!</p>

                                                                      <!-- SNS Link -->
                                                                      <ul class="list-inline">

                                                                                <!-- add jianshu add target = "_blank" to <a> by BY -->




                                                                      </ul>

                                                                      <a href=/contact />Contact</a>

                                                            </div>
                                                            <!-- <form class="input-iconic">
                                                                                                    <div class="input-icon"><button
                                                                                                                        type="submit"><span
                                                                                                                                  class="fas fa-search text-300"></span></button>
                                                                                                    </div><input class="form-control" type="search"
                                                                                                              placeholder="Search..." />
                                                                                          </form> -->
                                                            <!-- <h4 class="mt-5">Popular</h4><a class="mt-3 d-inline-block"
                                                                                                    href="page-blog-single.html"><img
                                                                                                              class="rounded w-100 fit-cover"
                                                                                                              src="/wallace//wallace/assets//img/blog-1.jpg" alt="" />
                                                                                                    <h5 class="mt-3">How to take the shame out of
                                                                                                              self-promotion</h5>
                                                                                          </a><a class="mt-4 d-inline-block"
                                                                                                    href="page-blog-single.html"><img
                                                                                                              class="rounded w-100 fit-cover"
                                                                                                              src="/wallace//wallace/assets//img/blog-3.jpg" alt="" />
                                                                                                    <h5 class="mt-3">Magic. My Macbook has been
                                                                                                              stolen.</h5>
                                                                                          </a> -->
                                                            <!-- <div class="mt-6">
                                                                                                    <h4>Tags</h4>
                                                                                                    <ul class="nav mt-3">
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Creativity</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Ideas</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Travel</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Art</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Psychology</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Life</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Music</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Books</a>
                                                                                                              </li>
                                                                                                              <li><a class="btn btn-xs btn-outline-secondary m-1"
                                                                                                                                  href="#">Movie</a>
                                                                                                              </li>
                                                                                                    </ul>
                                                                                          </div> -->
                                                            <!-- <div class="mt-6">
                                                                                                    <h4>Categories</h4>
                                                                                                    <ul class="bullet-inside pl-0 text-sans-serif">
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Design</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Programming</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Writing</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Games</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Typography</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Cricket</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Soccer</a>
                                                                                                              </li>
                                                                                                              <li><a class="text-600"
                                                                                                                                  href="#">Photography</a>
                                                                                                              </li>
                                                                                                    </ul>
                                                                                          </div> -->
                                                  </div>
                                        </div>
                              </div>
                    </div>
          </div><!-- end of .container-->
</section><!-- <section> close ============================-->
<!-- ============================================-->





    

  </main><!-- ===============================================-->
  <!--    End of Main Content-->
  <!-- ===============================================-->



  <!--===============================================-->
  <!--    Footer-->
  <!--===============================================-->
  <footer class="footer bg-black text-600 py-4 text-sans-serif text-center overflow-hidden" data-zanim-timeline="{}"
    data-zanim-trigger="scroll">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-4 order-lg-2"><a class="indicator indicator-up" href="#top"
            data-fancyscroll="data-fancyscroll"><span class="indicator-arrow indicator-arrow-one"
              data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":0.9}'></span><span
              class="indicator-arrow indicator-arrow-two"
              data-zanim-xs='{"from":{"opacity":0,"y":15},"to":{"opacity":1,"y":-5,"scale":1},"ease":"Back.easeOut","duration":0.4,"delay":1.05}'></span></a>
        </div>
        <div class="col-lg-4 text-lg-left mt-4 mt-lg-0">
          <p class="fs--1 text-uppercase ls font-weight-bold mb-0">
			  Copyright &copy; 2021 Wang Lab <br />
			  <a href="http://www.big.cas.cn/" target="_blank" class="text-600">@ Beijing Institute of Genomics, CAS.</a>
			  </p>
        </div>
        <div class="col-lg-4 text-lg-right order-lg-2 mt-2 mt-lg-0">
          <p class="fs--1 text-uppercase ls font-weight-bold mb-0" align="center">Made with<span
              class="text-danger fas fa-heart mx-1"></span>by <a class="text-600"
              href="/team/">Wang lab team</a></p>
            <p class="fs--1 text-uppercase ls font-weight-bold mb-0" align="center">
				<a href="http://beian.miit.gov.cn/" target="_blank" class="text-600">京ICP备2021031744号</a>				
			</p>
        </div>
      </div>
    </div>
  </footer>


  <!--===============================================-->
  <!--    Modal for language selection-->
  <!--===============================================-->
  <!-- Modal-->
  <div class="modal fade fade-in" id="languageModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xs mx-auto" role="document">
      <div class="modal-content bg-black">
        <div class="modal-body text-center p-0"><button
            class="close text-white position-absolute t-0 r-0 times-icon mt-2 mr-2 p-2" type="button"
            data-dismiss="modal" aria-label="Close"></button>
          <ul class="list-unstyled pl-0 my-0 py-4 text-sans-serif">
            <li><a class="text-white font-weight-bold pt-1 d-block" href="home-default.html">English</a></li>
            <li><a class="pt-1 d-block text-500" href="#">Français</a></li>
            <li><a class="text-500 pt-1 d-block" href="page-rtl.html">عربى</a></li>
            <li><a class="pt-1 d-block text-500" href="#">Deutsche</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
    <script>
        var base_url = "../..",
            shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};

        function jump(e) {
          let url = e.target.dataset.url;
          if(!url) return;
          
          location.href = url;
        }
		
		// comments out below two by wavefancy@gmail.com
        //document.getElementById('prev').addEventListener('click',jump);
        //document.getElementById('next').addEventListener('click',jump);
    </script>
    <!--wavefancy@gmail.com-->
    <!--<script src="../../js/base.js" defer></script>-->
    <script src="../../javascripts/mathjax.js" defer></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script src="../../search/main.js" defer></script>
  <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

  <!-- ===============================================-->
  <!--    JavaScripts-->
  <!-- ===============================================-->
 
	  <script src="/pages/assets/js/jquery.min.js"></script>
	
	  <script src="/pages/assets/js/bootstrap.js"></script>
	  <!--plugin is a must have js file-->
	  <script src="/pages/assets/js/plugins.min.js"></script>
	  
	  <script src="/pages/assets/lib/loaders.css/loaders.css.js"></script>
	  <script src="/pages/assets/js/stickyfill.min.js"></script>
	  <script src="/pages/assets/lib/is_js/is.min.js"></script>
	  <script src="/pages/assets/lib/jtap/jquery.tap.js"></script>
	  <script src="/pages/assets/js/rellax.min.js"></script>
	  <script src="/pages/assets/lib/fancybox/jquery.fancybox.min.js"></script>
	  <script src="/pages/assets/lib/isotope-layout/isotope.pkgd.min.js"></script>
	  <script src="/pages/assets/lib/isotope-packery/packery-mode.pkgd.min.js"></script>
	  <script src="/pages/assets/js/theme.js"></script>
	  <!--wavefancy@gmail.com-->
	  <!--<script src="../../js/base.js"></script>-->
	  <!--
	  <script src="/pages/assets/js/popper.min.js"></script>
	  <script src="/pages/assets/lib/lightbox2/js/lightbox.min.js"></script>
	  <script src="/pages/assets/js/progressbar.min.js"></script>
	  -->
	  
	  <script src="/pages/assets/lib/owl.carousel/owl.carousel.js"></script>
<!--	  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser-polyfill.min.js"></script>-->
	  <script src="/js/browser/browser-polyfill.min.js"></script>
	  <script src="/pages/assets/js/typed.js"></script>
	  
	  <script src="https://map.qq.com/api/gljs?v=1.exp&key=OM5BZ-54JK3-IXD3U-YML7K-TQKZK-RLBNC"></script>
</body>

</html>